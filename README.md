# file-compression-spr-xml

Консольное приложение для сжатия файлов формата jpeg, png.
В качестве библиотеки для сжатия файлов используется Tinify https://tinypng.com/developers/reference/java
Для работы библиотеки необходимо получить один или несколько ключей https://tinypng.com/developers.
Приложение собирается в исполняемый jar-файл.

Приложение разработано таким образом, чтобы сжать все файлы в обозначенной директории и дереве поддиректорий и
 сохранить исходную структуру директорий с этими файлами.
Для этого в отдельной директории формируется подобная исходной структура директорий и сжатые файлы перемещаются
 в эту отдельную директорию на то же место, как и в исходной директории.

Использование приложения:
1. В директории с jar файлом создать поддиректорию source-pictures, в нее поместить каталог или каталоги со сжимаемыми файлами.
2. В директории с jar файлом создать файл keys.txt, в него поместить ключи. Каждый ключ в новой строчке.
3. Запустить исполняемый jar файл командой:
java -jar file-compression-spr-xml-0.0.1.jar

По результатам работы приложения сжатые файлы будут расположены в директории с jar файлом в поддиректории result-pictures
 (на тех же местах в структуре каталогов, как и в поддиректории source-pictures).
Если ключей оказалось недостаточно для сжатия файлов, то удалить использованные ключи из файла keys.txt и добавить новые.
Количество сжатых файлов по завершению работы приложения записывается в директорию с jar файлом в поддиректорию 
compression-report в файл count-compressed.txt с меткой времени в названии.


По умолчанию файлы сжимает один поток и все ключи используются один раз (программа сжимает файлы по каждому ключу до получения 
исключения по этому ключу, после получения исключения перестает использовать данный ключ и берет следующий).
Если необходимо задать количество потоков (от 2 до 10) или количество повторного использования всех ключей после получения
 исключений по всем ключам (от 2 до 15), или и то и другое, то необходимо при запуске jar файла задать аргументы командной строки.
Значения для потоков и повторений указать без пробелов (если указать  thread = 10 - возникнет исключение и приложение завершиться).
Задать количество потоков и количество повторного использования ключей:
java -jar file-compression-spr-xml-0.0.1.jar thread=10 cycle=3

Задать только количество потоков:
java -jar file-compression-spr-xml-0.0.1.jar thread=10

Задать только количество повторений:
java -jar file-compression-spr-xml-0.0.1.jar cycle=3   

По завершению работы формируются отчеты в директории с jar файлом в поддиректории compression-report.
Файлы с отчетами имеют в названии метки времени.
Обозначения файлов:
count-compressed.txt - имя файла с отчетом о количестве сжатых файлов в результате работы приложения. 
failed-files.txt - имя файла для отчета со списком  файлов, которые не удалось сжать, либо возникли ошибки при перемещении в папку со сжатыми файлами, 
	 либо возникли ошибки при удалении файлов из папки с исходными файлами после сжатия.
failed-keys.txt - имя файла для отчета со списком не зарегистрированных на сервере Tinify ключей (не принадлежащих аутентифицированным пользователям).
compressed-files-by-key.txt - имя файла для отчета со списком ключей и количеством сжатых файлов по каждому ключу.
failed-read-files.txt - имя файла для отчета со списком  файлов, которые не удалось прочитать.

После сжатия всех файлов в поддиректории source-pictures очистить содержимое этой поддиректории. Перед добавлением новой партии файлов для 
сжатия в поддиректорию source-pictures и запуском приложения очистить поддиректорию result-pictures